<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>py简单抓取小说动态页面数据 - 公会驻地</title>

	<link rel="shortcut icon" href="/styles/images/favicon.jpg">
	<link rel="icon" href="/styles/images/favicon.jpg">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/styles/css/syntax.css">
	<link rel="canonical" href="/2017/06/07/py%E7%AE%80%E5%8D%95%E6%8A%93%E5%8F%96%E5%B0%8F%E8%AF%B4%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2%E6%95%B0%E6%8D%AE/">
	<link rel="alternate" type="application/rss+xml" title="公会驻地" href="/feed.xml">
	
	<meta name="keywords" content="py简单抓取小说动态页面数据, 公会驻地, 学而不思则罔;思而不学则殆;生命不止;折腾不休">
	<meta name="description" content="学而不思则罔;思而不学则殆;生命不止;折腾不休">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>

  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.jpg">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">    
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/categories/">大类分解</a>
        </li>
        <li>
          <a href="/tag">小类内聚</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
            <a><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></a>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">关于<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a rel="nofollow" target="_blank" href="https://github.com/anchoriteFili/">Github</a></li>
            <li><a rel="nofollow" target="_blank" href="https://anchoritefili.github.io">关于作者</a></li>
            <li><a rel="nofollow" href="/books">我的书单</a></li>
            <li><a rel="nofollow" href="/reference">推荐博客</a></li>
<!--            <li><a href="/feed.xml">RSS订阅</a></li>-->
            <li class="divider"></li>
            <li><a rel="nofollow" target="_blank" href="http://www.gonghuizhudi.com">个人官网</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>

    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>py简单抓取小说动态页面数据</h1>
		    <p>Post on Jun 07, 2017 by <a href="/about">anchoriteFili</a></p>
		-->
		    <h1>躬身以待方显气度，拧首抬杠略失品格。</h1>
    
  </div>
</div>

    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#知识-ref">知识</a>	/
    	<a href="/tag/#python-ref">python</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
  </ul>
  <div style="height: 200px;width: 200px;">
    <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5ytn1ssq6za&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"> 
    </script>
  </div>
</div>

 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">py简单抓取小说动态页面数据</h1>
              <!--
                <p class="post-meta">Jun 7, 2017</p>
              -->
              <div class="meta">Posted on <span class="postdate">Jun 07, 2017</span> By <a target="_blank" href="http://localhost:4000">anchoriteFili</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#1-打开页面观察是否是动态加载页面" id="markdown-toc-1-打开页面观察是否是动态加载页面">1. 打开页面，观察是否是动态加载页面</a></li>
  <li><a href="#2-查找隐藏的加载内容部分的链接" id="markdown-toc-2-查找隐藏的加载内容部分的链接">2. 查找隐藏的加载内容部分的链接</a></li>
  <li><a href="#3-找到链接所需要的对应的链接的参数" id="markdown-toc-3-找到链接所需要的对应的链接的参数">3. 找到链接所需要的对应的链接的参数<br /></a></li>
  <li><a href="#4-在网页源码中找到对应的参数" id="markdown-toc-4-在网页源码中找到对应的参数">4. 在网页源码中找到对应的参数<br /></a></li>
  <li><a href="#5-从源码中正则提取相关参数" id="markdown-toc-5-从源码中正则提取相关参数">5. 从源码中正则提取相关参数<br /></a></li>
  <li><a href="#6--拼接隐藏链接" id="markdown-toc-6--拼接隐藏链接">6.  拼接隐藏链接<br /></a></li>
  <li><a href="#7--开始正式的抓取页面中的数据" id="markdown-toc-7--开始正式的抓取页面中的数据">7.  开始正式的抓取页面中的数据<br /></a></li>
</ul>

<h5 id="1-打开页面观察是否是动态加载页面">1. 打开页面，观察是否是动态加载页面</h5>
<p><img src="/styles/images/resources/39E779EFF6DE48A73D424D7312ECE15A.png" alt="9.png" /></p>
<h5 id="2-查找隐藏的加载内容部分的链接">2. 查找隐藏的加载内容部分的链接</h5>
<p><img src="/styles/images/resources/67DF13A94408F7EA0C6D7B55DDA311EA.png" alt="1.png" /></p>
<h5 id="3-找到链接所需要的对应的链接的参数">3. 找到链接所需要的对应的链接的参数<br /></h5>
<p><img src="/styles/images/resources/F81242539B89D0512DB57084DF3FDF10.png" alt="2.png" /><br /></p>
<h5 id="4-在网页源码中找到对应的参数">4. 在网页源码中找到对应的参数<br /></h5>
<p><img src="/styles/images/resources/9DED5023271B5875C0F0BCAC6635406B.png" alt="3.png" /></p>
<h5 id="5-从源码中正则提取相关参数">5. 从源码中正则提取相关参数<br /></h5>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sign</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r'RP.sign = "(.*?)";'</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
<span class="n">book_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r'book_id":"(.*?)",'</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
<span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
<span class="err">　　</span><span class="k">print</span> <span class="s">'book_id'</span><span class="p">,</span> <span class="n">book_id</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="err">　　</span><span class="k">print</span> <span class="s">'sign'</span><span class="p">,</span> <span class="n">sign</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<span class="err">　　</span><span class="k">print</span> <span class="s">'no match'</span>
</code></pre></div></div>
<h5 id="6--拼接隐藏链接">6.  拼接隐藏链接<br /></h5>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contentURL</span> <span class="o">=</span> <span class="s">'http://book.km.com/index.php?c=catch&amp;a=getContent&amp;book_id=</span><span class="si">%</span><span class="s">s&amp;chapter_id=1&amp;sign=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">book_id</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sign</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<h5 id="7--开始正式的抓取页面中的数据">7.  开始正式的抓取页面中的数据<br /></h5>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python</span>
<span class="c">#-*- coding: utf-8 -*-</span>
<span class="c">#encoding=utf-8</span>


<span class="c"># 统一用于上传的方法打包</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">htmllib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">leancloud</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">'utf8'</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">bookcom</span><span class="p">:</span>
    <span class="n">NovelName</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">NovelImageUrl</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">NovelType</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">NovelChapter</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">NovelChapterContent</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">NovelChapterId</span> <span class="o">=</span> <span class="s">''</span>

    <span class="c"># 获取小说列表</span>
    <span class="k">def</span> <span class="nf">bookcomGetList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://book.km.com/shuku_0_0_0_1_0_0_1.html'</span><span class="p">)</span>
        <span class="n">pythonEtree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">pythonLink</span> <span class="o">=</span> <span class="n">pythonEtree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="imgbox"]/a'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">pythonLink</span><span class="p">:</span>
            <span class="c"># print each.xpath('img/@_src')[0]</span>
            <span class="c"># print each.xpath('img/@alt')[0]</span>
            <span class="c"># print each.xpath('@href')[0]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NovelName</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'img/@alt'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NovelImageUrl</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'img/@_src'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NovelType</span> <span class="o">=</span> <span class="s">'免费'</span>

            <span class="n">searchObjOne</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r'/shuku/(.*?).html'</span><span class="p">,</span> <span class="n">each</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'@href'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
            <span class="c"># print searchObjOne.group(1)</span>
            <span class="n">URLTwo</span> <span class="o">=</span> <span class="s">'http://book.km.com/chapterlist/</span><span class="si">%</span><span class="s">s.html'</span> <span class="o">%</span> <span class="n">searchObjOne</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c"># print URLTwo</span>
            <span class="c"># 保存图片列表</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bookcomGetListSave</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bookcomGetNovelList</span><span class="p">(</span><span class="n">URLTwo</span><span class="p">)</span>

    <span class="c"># 获取章节链接</span>
    <span class="k">def</span> <span class="nf">bookcomGetNovelList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">URL</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="s">'GET'</span><span class="p">)</span>
        <span class="c"># print html.text</span>
        <span class="n">pythonEtree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">pythonLink</span> <span class="o">=</span> <span class="n">pythonEtree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//ul[@class="catalog_list clearfix"]/li/a'</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">pythonLink</span><span class="p">:</span>
            <span class="c"># print each.xpath('@href')[0]</span>
            <span class="c"># print each.xpath('text()')[0]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapter</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'text()'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">novelContentUrl</span> <span class="o">=</span> <span class="s">'http://book.km.com</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">each</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'@href'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># print novelContentUrl</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bookcomGetNovelContent</span><span class="p">(</span><span class="n">novelContentUrl</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span>

    <span class="c"># 获取章节内容</span>
    <span class="k">def</span> <span class="nf">bookcomGetNovelContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">URL</span><span class="p">,</span> <span class="n">SuperURl</span><span class="p">):</span>
        <span class="c"># ********** 根据表面链接获取所有源码 **********</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:53.0) Gecko/20100101 Firefox/53.0'</span><span class="p">,</span>
                   <span class="s">'Accept'</span><span class="p">:</span> <span class="s">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span><span class="p">,</span>
                   <span class="s">'Cookie'</span><span class="p">:</span> <span class="s">'HTTP_REFERER=book.km.com; _ga=GA1.2.1574141621.1496282865; UM_distinctid=15c61689cad25e-04f45024755e92-49526a-fa000-15c61689cae39d; CNZZDATA30085487=cnzz_eid</span><span class="si">%3</span><span class="s">D2096924603-1496280564-</span><span class="si">%26</span><span class="s">ntime</span><span class="si">%3</span><span class="s">D1496291364; book_history=</span><span class="si">%5</span><span class="s">B</span><span class="si">%22</span><span class="s">b1343939</span><span class="si">%22%2</span><span class="s">C</span><span class="si">%22</span><span class="s">b1413544</span><span class="si">%22%5</span><span class="s">D; bdshare_firstime=1496282865098; Hm_lvt_b2e5ac9401b5820ffa4e9fa608593a5b=1496282865; Hm_lpvt_b2e5ac9401b5820ffa4e9fa608593a5b=1496296670; HTTP_REFERER=book.km.com'</span><span class="p">,</span>
                   <span class="s">'Referer'</span><span class="p">:</span> <span class="n">SuperURl</span>
            <span class="p">,</span> <span class="s">'Accept-Language'</span><span class="p">:</span> <span class="s">'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3'</span>
            <span class="p">,</span> <span class="s">'Connection'</span><span class="p">:</span> <span class="s">'keep-alive'</span>
            <span class="p">,</span> <span class="s">'Accept-Encoding'</span><span class="p">:</span> <span class="s">'gzip, deflate'</span>
            <span class="p">,</span> <span class="s">'Host'</span><span class="p">:</span> <span class="s">'book.km.com'</span>
            <span class="p">,</span> <span class="s">'Upgrade-Insecure-Requests'</span><span class="p">:</span> <span class="s">'1'</span>
            <span class="p">,</span> <span class="s">'Cache-Control'</span><span class="p">:</span> <span class="s">'max-age=0'</span>
                   <span class="p">}</span>

        <span class="n">html</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="c"># print html.text</span>
        <span class="c"># 在源码中抓取需要的参数</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r'RP.sign = "(.*?)";'</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="n">book_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r'book_id":"(.*?)",'</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="n">chapter_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r'"id":"(.*?)",'</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapterId</span> <span class="o">=</span> <span class="n">chapter_id</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># if sign:</span>
        <span class="c">#     print 'book_id', book_id.group(1)</span>
        <span class="c">#     print 'sign', sign.group(1)</span>
        <span class="c">#     print 'chapter_id', chapter_id.group(1)</span>
        <span class="c"># else:</span>
        <span class="c">#     print 'no match'</span>

        <span class="n">contentHeader</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'Accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
            <span class="p">,</span> <span class="s">'Accept-Encoding'</span><span class="p">:</span> <span class="s">'gzip, deflate'</span>
            <span class="p">,</span> <span class="s">'Accept-Language'</span><span class="p">:</span> <span class="s">'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3'</span>
            <span class="p">,</span> <span class="s">'Connection'</span><span class="p">:</span> <span class="s">'keep-alive'</span>
            <span class="p">,</span>
            <span class="s">'Cookie'</span><span class="p">:</span> <span class="s">'_ga=GA1.2.1574141621.1496282865; UM_distinctid=15c61689cad25e-04f45024755e92-49526a-fa000-15c61689cae39d; CNZZDATA30085487=cnzz_eid</span><span class="si">%3</span><span class="s">D2096924603-1496280564-</span><span class="si">%26</span><span class="s">ntime</span><span class="si">%3</span><span class="s">D1496800002; book_history=</span><span class="si">%5</span><span class="s">B</span><span class="si">%22</span><span class="s">b1343939</span><span class="si">%22%2</span><span class="s">C</span><span class="si">%22</span><span class="s">b1413544</span><span class="si">%22%5</span><span class="s">D; bdshare_firstime=1496282865098; Hm_lvt_b2e5ac9401b5820ffa4e9fa608593a5b=1496282865,1496631345; _gat=1'</span>
            <span class="p">,</span> <span class="s">'Host'</span><span class="p">:</span> <span class="s">'book.km.com'</span>
            <span class="p">,</span> <span class="s">'Referer'</span><span class="p">:</span> <span class="n">URL</span>
            <span class="p">,</span> <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:53.0) Gecko/20100101 Firefox/53.0'</span>
            <span class="p">,</span> <span class="s">'X-Requested-With'</span><span class="p">:</span> <span class="s">'XMLHttpRequest'</span>
        <span class="p">}</span>

        <span class="c"># 拼接隐藏接口</span>
        <span class="c"># print 'http://book.km.com/index.php?c=catch&amp;a=getContent&amp;book_id=%s&amp;chapter_id=1&amp;sign=%s' % (</span>
        <span class="c"># book_id.group(1), sign.group(1))</span>
        <span class="n">contentURL</span> <span class="o">=</span> <span class="s">'http://book.km.com/index.php?c=catch&amp;a=getContent&amp;book_id=</span><span class="si">%</span><span class="s">s&amp;chapter_id=</span><span class="si">%</span><span class="s">s&amp;sign=</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">book_id</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">chapter_id</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sign</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">contentHtml</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">contentURL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">contentHeader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapterContent</span> <span class="o">=</span> <span class="n">contentHtml</span><span class="o">.</span><span class="n">text</span>

        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelName</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelImageUrl</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelType</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapter</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapterId</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapterContent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bookcomChapterSave</span><span class="p">()</span>

        <span class="c"># 获取小说内容</span>
        <span class="c"># print contentHtml.text</span>

    <span class="k">def</span> <span class="nf">bookcomChapterSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Todo</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">'XuanHuanContent'</span><span class="p">)</span>
        <span class="n">todo</span> <span class="o">=</span> <span class="n">Todo</span><span class="p">()</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelName'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelName</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelChapterId'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapterId</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelChapter'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapter</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelChapterContent'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelChapterContent</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">bookcomGetListSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Todo</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">'XuanHuanList'</span><span class="p">)</span>
        <span class="n">todo</span> <span class="o">=</span> <span class="n">Todo</span><span class="p">()</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelImageUrl'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelImageUrl</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelType'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelType</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'NovelName'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NovelName</span><span class="p">)</span>
        <span class="n">todo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">leancloud</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
<span class="n">Book</span> <span class="o">=</span> <span class="n">bookcom</span><span class="p">()</span>
<span class="n">Book</span><span class="o">.</span><span class="n">bookcomGetList</span><span class="p">()</span>
<span class="c"># Book.bookcomGetNovelList('http://book.km.com/chapterlist/940750.html')</span>
</code></pre></div></div>

            </article>
        </div>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2014-2018 <a href="https://anchoritefili.github.io"><code>anchoriteFili</code></a>.</p>
		<p>Powered by <a href="http://jekyllrb.com">Jekyll</a>, themed from <a href="http://lesscss.cn/">Less</a>, refactored by <a href="http://www.hifreud.com/">Freud Kang</a></p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  </body>
</html>
